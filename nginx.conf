worker_processes auto;
error_log /var/log/nginx/error.log warn;
pid /tmp/nginx.pid;

events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    charset utf-8;
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;

    # Gzip
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_min_length 256;
    gzip_types text/html text/css text/xml text/plain
               application/javascript application/json
               image/svg+xml;

    server {
        listen 8080;
        server_name _;

        root /usr/share/nginx/html;

        # HTML â€” no cache (instant updates on redeploy)
        location = / {
            try_files /rework-guide.html =404;
            add_header Cache-Control "no-cache";
        }

        # SVG logo
        location = /rework-logo.svg {
            add_header Cache-Control "public, max-age=86400";
        }

        # Pictures from volume
        location /pictures/ {
            alias /data/pictures/;
            add_header Cache-Control "public, max-age=86400";
            try_files $uri =404;
        }

        # Health check
        location = /health {
            access_log off;
            return 200 "ok";
            add_header Content-Type text/plain;
        }
    }
}
